<?xml version='1.0' encoding='UTF-8'?>
<document>
  <properties>
    <title>Setting role-based search</title>
    <author>Shinsuke Sugaya</author>
  </properties>
  <body>
    <section name='With role-based search'>
      <p>You can divide out search results in Fess in any authentication system authenticated users credentials to. For example, find rolls a does appears role information in search results with the roles a user a user b will not display it. By using this feature, user login in the portal and single sign-on environment belongs to you can enable search, sector or job title.</p>
      <p>In role-based search of the Fess roll information available below.</p>
      <ul>
        <li>Request parameter</li>
        <li>Request header</li>
        <li>Cookies</li>
        <li>J2EE authentication information</li>
      </ul>
      <p>To save authentication information in cookies for authentication when running of Fess in portal and agent-based single sign-on system domain and path that can retrieve role information. You can also reverse proxy type single sign-on system access to Fess adding authentication information in the request headers and request parameters to retrieve role information.</p>
    </section>
    <section name='Setting role-based search'>
      <p>Describes how to set up role-based search using J2EE authentication information.</p>
      <subsection name='Tomcat-users.xml settings'>
        <p>conf/Tomcat-users.XML the add roles and users. This time the role1 role perform role-based search. Login to role1.</p>
      <source><![CDATA[
<?xml version='1.0' encoding='utf-8'?>
<tomcat-users>
  <role rolename="fess"/>
  <role rolename="solr"/>
  <role rolename="role1"/>
  <user username="admin" password="admin" roles="fess"/>
  <user username="solradmin" password="solradmin" roles="solr"/>
  <user username="role1" password="role1" roles="role1"/>
</tomcat-users>
]]></source>
      </subsection>
      <subsection name='app.dicon settings'>
        <p>sets the webapps/fess/WEB-INF/classes/app.dicon shown below.</p>
      <source><![CDATA[
    :
    <component name="roleQueryHelper" class="jp.sf.fess.helper.impl.RoleQueryHelperImpl">
        <property name="defaultRoleList">
            {"guest"}
        </property>
    </component>
    :
]]></source>
        <p>You can set the role information by setting the defaultRoleList, there is no authentication information. Do not display the search results need roles for users not logged in you.</p>
      </subsection>
      <subsection name='Fess.dicon settings'>
        <p>sets the webapps/fess/WEB-INF/classes/fess.dicon shown below.</p>
      <source><![CDATA[
    :
    <component name="systemHelper" class="jp.sf.fess.helper.SystemHelper">
        <property name="authenticatedRoles">"role1"</property>
    </component>
    :
]]></source>
        <p>authenticatedRoles can describe multiple by commas (,).</p>
      </subsection>
      <subsection name='Web.xml settings'>
        <p>sets the webapps/fess/WEB-INF/web.xml shown below.</p>
      <source><![CDATA[
  :
  <security-constraint>
    <web-resource-collection>
      <web-resource-name>Fess Authentication</web-resource-name>
      <url-pattern>/login/login</url-pattern>
    </web-resource-collection>
    <auth-constraint>
      <role-name>fess</role-name>
      <role-name>role1</role-name>
    </auth-constraint>
  </security-constraint>
  :
  <security-role>
    <role-name>fess</role-name>
  </security-role>

  <security-role>
    <role-name>role1</role-name>
  </security-role>
  :
]]></source>
      </subsection>
      <subsection name='Settings in the Administration screen of the Fess'>
        <p>Fess up and log in as an administrator. From the role of the menu set name Role1 (any name) and value register role at role1. After the crawl settings want to use in the user with the role1 in, crawl Crawl Settings select Role1.</p>
      </subsection>
      <subsection name='Log roll'>
        <p>Log out from the management screen. log in as user Role1. A successful login and redirect to the top of the search screen.</p>
        <p>Only thing was the Role1 role setting in the crawl settings search as usual, and displayed.</p>
        <p>Also, search not logged in will be search by guest user.</p>
      </subsection>
      <subsection name='Roll out'>
        <p>Whether or not logged out, logged in a non-Admin role to access http://localhost:8080/fess/admin screen appears. By pressing the logout button will log out.</p>
      </subsection>
    </section>
  </body>
</document>
