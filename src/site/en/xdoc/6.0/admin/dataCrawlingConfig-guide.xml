<?xml version='1.0' encoding='UTF-8'?>
<document>
  <properties>
    <title>Settings for crawling the data store</title>
    <author>Sone, Takaaki</author>
    <author>Shinsuke Sugaya</author>
  </properties>
  <body>
    <section name='Overview'>
      <p>You can crawl databases in Fess. Here are required to store settings.</p>
    </section>
    <section name='How to set up'>
      <subsection name='How to display'>
        <p>In Administrator account after logging in, click menu data store.</p>
        <img alt='Data store configuration' src='/images/ja/6.0/admin/dataStoreCrawling-1.png'/>
        <p>As an example, the following table database named testdb MySQL, user name hoge, fuga password connection and the will to make it.</p>
        <source><![CDATA[
CREATE TABLE doc (
    id BIGINT NOT NULL AUTO_INCREMENT,
    title VARCHAR(100) NOT NULL,
    content VARCHAR(255) NOT NULL,
    latitude VARCHAR(20),
    longitude VARCHAR(20),
    versionNo INTEGER NOT NULL,
    PRIMARY KEY (id)
);
]]></source>
        <p>Here the data is put something like the following.</p>
        <source><![CDATA[
INSERT INTO doc (title, content, latitude, longitude, versionNo) VALUES ('タイトル 1', 'コンテンツ 1 です．', '37.77493', ' -122.419416', 1);
INSERT INTO doc (title, content, latitude, longitude, versionNo) VALUES ('タイトル 2', 'コンテンツ 2 です．', '34.701909', '135.494977', 1);
INSERT INTO doc (title, content, latitude, longitude, versionNo) VALUES ('タイトル 3', 'コンテンツ 3 です．', '-33.868901', '151.207091', 1);
INSERT INTO doc (title, content, latitude, longitude, versionNo) VALUES ('タイトル 4', 'コンテンツ 4 です．', '51.500152', '-0.126236', 1);
INSERT INTO doc (title, content, latitude, longitude, versionNo) VALUES ('タイトル 5', 'コンテンツ 5 です．', '35.681382', '139.766084', 1);
]]></source>
      </subsection>
    </section>
    <section name='Setting item'>
      <subsection name='Parameter'>
        <p>Parameter settings example looks like the following.</p>
        <source><![CDATA[
driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/testdb?useUnicode=true&characterEncoding=UTF-8
username=hoge
password=fuga
sql=select * from doc
]]></source>
        <p>Parameter is a &quot;key = value&quot; format. Description of the key is as follows.</p>
        <table class='table table-striped table-bordered table-condensed'>
          <tbody>
            <tr class='a'>
              <td align='left'>driver</td>
              <td align='left'>Driver class name</td>
            </tr>
            <tr class='b'>
              <td align='left'>URL</td>
              <td align='left'>URL</td>
            </tr>
            <tr class='a'>
              <td align='left'>username</td>
              <td align='left'>To connect to the DB user name</td>
            </tr>
            <tr class='b'>
              <td align='left'>password</td>
              <td align='left'>To connect to the DB password</td>
            </tr>
            <tr class='a'>
              <td align='left'>SQL</td>
              <td align='left'>Want to crawl to get SQL statement</td>
            </tr>
          </tbody>
        </table>
      </subsection>
      <subsection name='Script'>
        <p>Script configuration example looks like the following.</p>
        <source><![CDATA[
url="http://localhost/" + id
host="localhost"
site="localhost"
title=title
content=content
cache=content
digest=content
anchor=
contentLength=content.length()
lastModified=content.length()
location=latitude + "," + longitude
latitude_s=latitude
longitude_s=longitude
]]></source>
        <p>
          Parameter is a &quot;key = value&quot; format.
        Description of the key is as follows.</p>
        <p>
          Side of the value written in OGNL. Close the string in double quotation marks.
        Access in the database column name, its value.</p>
        <table class='table table-striped table-bordered table-condensed'>
          <tbody>
            <tr class='a'>
              <td align='left'>URL</td>
              <td align='left'>URLs (links appear in search results)</td>
            </tr>
            <tr class='b'>
              <td align='left'>host</td>
              <td align='left'>Host name</td>
            </tr>
            <tr class='a'>
              <td align='left'>site</td>
              <td align='left'>Site pass</td>
            </tr>
            <tr class='b'>
              <td align='left'>title</td>
              <td align='left'>Title</td>
            </tr>
            <tr class='a'>
              <td align='left'>content</td>
              <td align='left'>Content (string index)</td>
            </tr>
            <tr class='b'>
              <td align='left'>cache</td>
              <td align='left'>Content cache (not indexed)</td>
            </tr>
            <tr class='a'>
              <td align='left'>Digest</td>
              <td align='left'>Digest piece that appears in the search results</td>
            </tr>
            <tr class='b'>
              <td align='left'>anchor</td>
              <td align='left'>Links to content (not usually required)</td>
            </tr>
            <tr class='a'>
              <td align='left'>contentLength</td>
              <td align='left'>The length of the content</td>
            </tr>
            <tr class='b'>
              <td align='left'>lastModified</td>
              <td align='left'>Content last updated</td>
            </tr>
          </tbody>
        </table>
      </subsection>
      <subsection name='Driver'>
        <p>To connect to the database driver is needed. keep the jar file in webapps/fess/WEB-INF/cmd/lib.</p>
      </subsection>
      <subsection name='Display parameters'>
        <p>Set the following in the webapps/fess/WEB-INF/classes/app.dicon if you see the item value, such as latitude_s in the search results. After adding to $ {doc.latitude_s}, searchResults.jsp;</p>
        <source><![CDATA[
    <component name="queryHelper" class="jp.sf.fess.helper.impl.QueryHelperImpl">
        <property name="responseFields">new String[]{"id", "score", "boost",
            "contentLength", "host", "site", "lastModified", "mimetype",
            "tstamp", "title", "digest", "url", "latitude_s","longitude_s" }</property>
    </component>
]]></source>
      </subsection>
    </section>
  </body>
</document>
